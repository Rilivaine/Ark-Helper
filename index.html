<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://kit.fontawesome.com/8fe24d2298.js" crossorigin="anonymous"></script>
  <title>Ark React</title>
  <style>
    body {
      margin: 0px;
      background-color: #666;
      color: #dddddd;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
    }

    #container-main,
    #container-settings {
      height: 100dvh;
      width: fit-content;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      gap: .5em;
    }

    .ramp-entry {
      display: flex;
      justify-content: center;
      gap: .5em
    }

    .container-number {
      width: 10%;
    }

    .container-number,
    .truck-number {
      text-align: center;
      background-color: #444;
      text-transform: uppercase;
      color: #dddddd;

      outline: none;
      border: none;
      border-radius: 5px;
      padding: 2px;
    }

    .container-number:focus,
    .truck-number:focus {
      border: none;
      border-bottom: 2px solid red;
      border-width: 1px;
    }

    .button {
      background-color: #444;
      border-radius: 10px;
      padding: 5px;
    }

    .button:hover {
      cursor: pointer;
    }

    #get-data-button {
      border: 1px solid #007500;
    }

    #clear-data-button {
      border: 1px solid #750000;
    }

    #settings-button {
      position: absolute;
      size: 35px;
      top: 10px;
      right: 10px;
    }

    #popup {
      text-align: center;
      font-size: 18px;
      width: fit-content;
      height: fit-content;
      background-color: #666;
      border: 2px solid #BBBB00;
      border-radius: 10px;
      padding: 5px;
      position: absolute;
      inset: 50% 50%;
      transform: translate(-50%, -50%);
    }

    /* Chrome, Safari, Edge, Opera */
    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    /* Firefox */
    input[type=number] {
      appearance: none;
      -moz-appearance: textfield;
    }
  </style>
</head>

<body>
  <script>
    const startingRampNumber = 225;
    const endingRampNumber = 245;

    document.addEventListener('load', (() => {
      const data = loadDataFromLocalStorage();

      buildPage();
      loadDataToInputs(data);
    })());

    function buildPage() {
      const mainContainer = document.createElement('div');
      mainContainer.id = 'container-main';

      const settingsContainer = document.createElement('div');
      settingsContainer.id = 'container-settings';
      settingsContainer.style.display = 'none';

      for (let i = startingRampNumber; i <= endingRampNumber; i++) {
        const rampWrapper = document.createElement('div');
        rampWrapper.classList.add('ramp-entry');
        rampWrapper.id = i?.toString();

        const rampNumber = document.createElement('span');
        rampNumber.textContent = `Ramp ${i}`;
        rampWrapper.append(rampNumber);

        const containerNumber = document.createElement('input');
        containerNumber.classList.add('container-number');
        containerNumber.setAttribute('type', 'number');
        containerNumber.setAttribute('data-ramp', i?.toString());
        rampWrapper.append(containerNumber);

        const truckNumber = document.createElement('input');
        truckNumber.classList.add('truck-number');
        truckNumber.setAttribute('type', 'text');
        truckNumber.setAttribute('data-ramp', i?.toString());
        rampWrapper.append(truckNumber);

        mainContainer.append(rampWrapper);
      }

      const getDataButton = document.createElement('div');
      getDataButton.id = 'get-data-button';
      getDataButton.classList.add('button');
      getDataButton.textContent = 'Compose message!';
      getDataButton.addEventListener('click', () => {
        const data = getDataFromInputs();
        saveDataToLocalStorage(data);
        copyToClipboard(composeMessage(data));
        showTempPopup("Message copied!", 5_000);
      });
      mainContainer.append(getDataButton);

      const settingsButton = document.createElement('div');
      settingsButton.id = 'settings-button';
      settingsButton.classList.add('button');

      const settingsIcon = document.createElement('i');
      settingsIcon.classList.add('fa-solid');
      settingsIcon.classList.add('fa-gears');
      settingsButton.append(settingsIcon);

      settingsButton.addEventListener('click', () => {
        toggleSettings();
      });
      document.body.append(settingsButton);

      const clearDataButton = document.createElement('div');
      clearDataButton.id = 'clear-data-button';
      clearDataButton.classList.add('button');
      clearDataButton.textContent = 'Clear data!';
      clearDataButton.addEventListener('click', () => {
        clearDataFromInputs();
        showTempPopup("Data cleared!", 5_000);
      });
      settingsContainer.append(clearDataButton);

      document.body.append(settingsContainer);
      document.body.append(mainContainer);
    }

    function toggleSettings() {
      const mainContainer = document.getElementById('container-main');
      const settingsContainer = document.getElementById('container-settings');

      if (mainContainer.style.display == 'none') {
        mainContainer.style.display = 'inherit';
        settingsContainer.style.display = 'none';
      } else {
        mainContainer.style.display = 'none';
        settingsContainer.style.display = 'inherit';
      }
    }

    function showTempPopup(text, timeInMs) {
      const oldPopup = document.getElementById('popup');
      if (!!oldPopup) {
        oldPopup.remove();
      }

      const popup = document.createElement('div');
      popup.id = 'popup';
      popup.textContent = text;
      document.body.append(popup);

      setTimeout(() => {
        popup.remove();
      }, timeInMs);
    }

    function clearDataFromInputs() {
      const containerNumbers = document.querySelectorAll('.container-number');
      const truckNumbers = document.querySelectorAll('.truck-number');

      containerNumbers.forEach(
        (/** @type {HTMLInputElement} */ i) => {
          i.value = "";
        });

      truckNumbers.forEach((/** @type {HTMLInputElement} */ i) => {
        i.value = "";
      });
    }

    function loadDataToInputs(data) {
      const containerNumbers = document.querySelectorAll('.container-number');
      const truckNumbers = document.querySelectorAll('.truck-number');

      containerNumbers.forEach(
        (/** @type {HTMLInputElement} */ i) => {
          /** @type {!string} */
          const ramp = i.getAttribute('data-ramp');

          i.value = data?.[ramp]['containerNumber']?.trim() ?? "";
        });

      truckNumbers.forEach((/** @type {HTMLInputElement} */ i) => {
        const ramp = i.getAttribute('data-ramp');

        i.value = data?.[ramp]['truckNumber']?.trim() ?? "";
      });
    }

    function getDataFromInputs() {
      let data = new Object({});
      const containerNumbers = document.querySelectorAll('.container-number');
      const truckNumbers = document.querySelectorAll('.truck-number');

      containerNumbers.forEach(
        (/** @type {HTMLInputElement} */ i) => {
          /** @type {!string} */
          const ramp = i.getAttribute('data-ramp');
          if (!data[ramp])
            data[ramp] = {};

          if (i.value) {
            data[ramp]['containerNumber'] = i.value;
          }
        });

      truckNumbers.forEach((/** @type {HTMLInputElement} */ i) => {
        const ramp = i.getAttribute('data-ramp');
        if (!data[ramp]) {
          data[ramp] = {};
        }

        if (i.value) {
          data[ramp]['truckNumber'] = i.value.toUpperCase();
        }
      });

      return data;
    }

    function saveDataToLocalStorage(data) {
      const saveData = JSON.stringify(data);

      localStorage.setItem('save',
        saveData);
    }

    function loadDataFromLocalStorage() {
      const saveData = localStorage.getItem('save');

      return JSON.parse(saveData);
    }

    function composeMessage(data) {
      let message = '';

      for (let i = startingRampNumber; i <= endingRampNumber; i++) {
        message += `${i} -> ${data?.[i].containerNumber ?? data?.[i].truckNumber ?? "-"}${data?.[i].containerNumber ? data?.[i].truckNumber ? ' | ' + data?.[i].truckNumber : "" : ""}\n`;
      }

      return message;
    }

    /*
            This function was used because for some
            reason `navigator.clipboard` wasn't working on mobile
        */
    async function copyToClipboard(textToCopy) {
      // Use the 'out of viewport hidden text area' trick
      const textArea = document.createElement("textarea");
      textArea.value = textToCopy;

      // Move textarea out of the viewport so it's not visible
      textArea.style.position = "absolute";
      textArea.style.left = "-999999px";

      document.body.prepend(textArea);
      textArea.select();

      try {
        document.execCommand('copy');
      } catch (error) {
        console.error(error);
      } finally {
        textArea.remove();
      }
    }
  </script>

</body>

</html>